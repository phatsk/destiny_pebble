<!doctype html>
<html>
	<head>
		<title>Destiny Pebble Configuration</title>
		<script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
		<style>
		.error {
			background: #FF7070;
			float: left;
			padding: 8px;
			border-radius: 5px;
			display: none;
		}
		</style>
	</head>
	<body>
		<form>
			<select name="platform">
				<option value="xbl">XBL</option>
				<option value="psn">PSN</option>
			</select>

			<input type="text" name="gamertag" placeholder="Gamertag" />

			<button type="submit">Save</button>
		</form>
		<hr />
		<div id="missing-error" class="error">
			All fields are required.
		</div>
		<div id="gamertag-error" class="error">
			Could not find the specified gamertag on the specified network.
		</div>
	</body>
	<script>
	jQuery(document).ready(function(){
		var required = {
			platform: null,
			gamertag: null
		};

		jQuery('button').on('click', function(event){
			event.preventDefault();
			event.stopPropagation();

			var missing = false;

			jQuery('form input, form select').each(function(){
				if(this.name && required.hasOwnProperty(this.name))
				{
					reqiured[this.name] = this.value;

					if(!required[this.name])
					{
						missing = true;
					}
				}
			});

			if(missing)
			{
				jQuery('#missing-error').show();
			}
			else
			{
				window.location = 'pebblejs://close#' + encodeURIComponent(JSON.stringify(required));
			}
		});
	});
	</script>
</html>
